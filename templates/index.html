<!DOCTYPE html>
<html>
<head>
  <title>控制 ROS 無人車</title>
</head>
<body>
  <h2>遠端控制</h2>

  <div id="time" style="font-size: 18px; margin-bottom: 10px;"></div>
  <div id="latency" style="font-size: 16px; color: green; margin-bottom: 10px;"></div>

  <button onclick="send('forward')">前進</button>
  <button onclick="send('back')">後退</button>
  <button onclick="send('stop')">停止</button>

  <script>
    function updateTime() {
      const now = new Date();
      const formatted = now.toLocaleString();
      document.getElementById('time').innerText = "現在時間：" + formatted;
    }

    // 每秒更新時間
    setInterval(updateTime, 1000);
    updateTime();

    function send(cmd) {
      const t0 = performance.now();  // 傳送前時間戳

      fetch('https://ros-web-control.onrender.com/control', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ command: cmd })
      })
      .then(res => res.json())
      .then(data => {
        const t1 = performance.now();  // 接收回應後時間戳
        const latency = Math.round(t1 - t0);
        document.getElementById('latency').innerText = `傳輸延遲：約 ${latency} ms`;
        alert("已送出指令：" + cmd);
      });
    }
  </script>
</body>
</html>
