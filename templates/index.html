<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>控制 ROS 無人車</title>
</head>
<body>
  <h2>遠端控制介面</h2>

  <div>
    <button onclick="send('forward')">前進</button>
    <button onclick="send('backward')">後退</button>
    <button onclick="send('stop')">停止</button>
  </div>

  <hr>

  <div id="clientTime" style="font-size: 16px; margin-top: 10px;"></div>
  <div id="serverTime" style="font-size: 16px;"></div>
  <div id="delay" style="font-size: 16px;"></div>

  <script>
    function getFormattedTime(date) {
      return date.getFullYear() + '-' +
             String(date.getMonth() + 1).padStart(2, '0') + '-' +
             String(date.getDate()).padStart(2, '0') + ' ' +
             String(date.getHours()).padStart(2, '0') + ':' +
             String(date.getMinutes()).padStart(2, '0') + ':' +
             String(date.getSeconds()).padStart(2, '0') + '.' +
             String(date.getMilliseconds()).padStart(3, '0');
    }

    function send(cmd) {
      const now = new Date();
      const clientTime = now.toISOString();  // 送出給伺服器（UTC）
      const localDisplay = getFormattedTime(now);  // 顯示用（本地時間）

      fetch('https://ros-web-control.onrender.com/control', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ command: cmd, client_time: clientTime })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById('clientTime').innerText = "📲 手機送出時間：" + localDisplay;
        document.getElementById('serverTime').innerText = "🕒 台灣伺服器時間：" + data.server_time_taiwan;
        document.getElementById('delay').innerText = "⏱ 指令延遲：" + data.delay_ms + " 毫秒";
      });
    }
  </script>
</body>
</html>
